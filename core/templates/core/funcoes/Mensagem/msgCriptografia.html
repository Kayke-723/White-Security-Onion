{% extends "core/base.html" %}
{% load static %}
{% block content %}

<head>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body class="bg_Ceu text-white overflow-y-auto min-h-screen">
    <!-- TÍTULO CENTRAL -->
    <header class="left-7 flex justify-items-center relative gap-x-10">
        <a href="{% url 'home' %}"
            class="no-underline decoration-transparent hover:opacity-80 transition duration-200 inline-block"
            style="text-decoration: none !important;">
            <h1
                class="text-5xl font-bold text-white flex items-center justify-center gap-2 drop-shadow-[0_0_20px_rgba(255,255,255,0.3)]">
                White Security
                <span class="relative flex items-center">
                    <span class="opacity-0 select-none">O</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="none"
                        class="w-12 h-12 absolute left-0 top-1/2 -translate-y-1/2 animate-spin-slow">
                        <defs>
                            <linearGradient id="ringGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#ffffff" />
                                <stop offset="50%" stop-color="#c084fc" />
                                <stop offset="100%" stop-color="#ffffff" />
                            </linearGradient>
                        </defs>
                        <circle cx="50" cy="50" r="40" stroke="url(#ringGradient)" stroke-width="3" />
                        <path d="M50 15 Q75 35 50 55 Q25 75 50 95" stroke="url(#ringGradient)" stroke-width="2"
                            opacity="0.8" />
                        <path d="M50 25 Q70 40 50 55 Q30 70 50 85" stroke="url(#ringGradient)" stroke-width="1.5"
                            opacity="0.6" />
                    </svg>
                    <span class="ml-[0.5rem]">nion</span>
                </span>
            </h1>
        </a>


    </header>
    <div class="flex flex-col items-center justify-start w-full px-6 py-16">

        <!-- TÍTULO -->
        <h1 class="text-4xl font-bold mb-8 text-center">Criptografia de Mensagens</h1>
        <p class="text-gray-300 text-lg max-w-3xl text-center mb-10">
            Experimente como a criptografia transforma uma mensagem simples em um código secreto.
            Crie uma <span class="text-blue-400 font-semibold">chave secreta</span> e veja como apenas ela pode revelar
            o
            conteúdo original.
        </p>

        <!-- FORMULÁRIO -->
        <div class="bg_CeuMenu/50 border-2 border-white p-8 rounded-2xl shadow-2xl w-full max-w-2xl space-y-6 mb-20">
            <div>
                <label for="mensagem" class="block text-lg font-semibold mb-2">Mensagem:</label>
                <textarea id="mensagem"
                    class="w-full p-3 rounded-lg bg-gray-700/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                    rows="4" placeholder="Digite sua mensagem..."></textarea>
            </div>

            <div>
                <label for="secretKey" class="block text-lg font-semibold mb-2">Chave secreta (secretKey):</label>
                <input id="secretKey" type="text"
                    class="w-full p-3 rounded-lg bg-gray-700/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Ex: minhaSenha123">
            </div>

            <div class="flex justify-between mt-4">
                <button id="btnCriptografar"
                    class="bg-blue-600 hover:bg-blue-700 px-5 py-3 rounded-lg font-semibold text-white transition">Criptografar
                </button>
                <button id="btnDescriptografar"
                    class="bg-blue-600 hover:bg-green-700 px-5 py-3 rounded-lg font-semibold text-white transition">Descriptografar
                </button>
            </div>

            <div id="resultado"
                class="mt-6 bg-black/40 p-4 rounded-lg text-gray-300 text-sm break-all border border-white/10"></div>
        </div>


        <!-- SCRIPT -->
        <script>
            async function enviarDados(url, dados) {
                const resposta = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify(dados)
                })
                return resposta.json()
            }

            document.getElementById('btnCriptografar').addEventListener('click', async () => {
                const mensagem = document.getElementById('mensagem').value.trim()
                const secretKey = document.getElementById('secretKey').value.trim()
                if (!mensagem || !secretKey) return alert('Preencha todos os campos.')

                const data = await enviarDados("{% url 'criptografar_mensagem' %}", { mensagem, secretKey })
                if (data.mensagem_criptografada) {
                    document.getElementById('resultado').innerHTML =
                        `<b>Mensagem criptografada:</b><br><code class='text-blue-400'>${data.mensagem_criptografada}</code>`
                } else {
                    alert(data.erro || 'Erro ao criptografar')
                }
            })

            document.getElementById('btnDescriptografar').addEventListener('click', async () => {
                const mensagem = document.getElementById('mensagem').value.trim()
                const secretKey = document.getElementById('secretKey').value.trim()
                if (!mensagem || !secretKey) return alert('Preencha todos os campos.')

                const data = await enviarDados("{% url 'descriptografar_mensagem' %}", { mensagem, secretKey })
                if (data.mensagem_original) {
                    document.getElementById('resultado').innerHTML =
                        `<b>Mensagem original:</b><br><code class='text-green-400'>${data.mensagem_original}</code>`
                } else {
                    alert(data.erro || 'Erro ao descriptografar')
                }
            });
        </script>

</body>
{% endblock %}